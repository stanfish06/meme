# Test fimo
$out_dir = 'results/fimo1';
$out_file = catfile($out_dir, 'fimo.tsv');
&test('fimo1', '',
  'fimo', '',
  [
    '--oc', $out_dir, 
    '--thresh', 0.001, 
    '--norc',
    make_test_src_path('common/MCM1.meme.html'), 
    make_test_src_path('common/spiked.fasta')
  ],
  [
    {
      output => $out_file, 
      reference => make_test_src_path('fimo/fimo.tsv'), 
      type => 'text', 
      ignore => ['^#']
    }
  ],
  $out_dir
);

# Test fimo with --motif option and --no-qvalue
$out_dir = 'results/fimo2';
$out_file = catfile($out_dir, 'fimo.tsv');
&test('fimo2', '',
  'fimo', '',
  [
    '--oc', $out_dir, 
    '--motif', 'CGGYGGGG', 
    '--motif', 'GCATCRGRBSAGA', 
    '--no-qvalue',
    '--motif-pseudo', 0.01, 
    '--thresh', 0.01, 
    'common/crp0.meme.xml', 
    make_test_src_path('common/spiked.fasta')
  ],
  [
    {
      output => $out_file, 
      reference => make_test_src_path('fimo/fimo-motif23.tsv'), 
      type => 'text', 
      ignore => ['^#']
    }
  ],
  $out_dir
);

# Test fimo with --psp and --prior-dist options
$out_dir = 'results/fimo3';
$out_file = catfile($out_dir, 'fimo.tsv');
&test('fimo3', '',
  'fimo', '',
  [
    '--oc', $out_dir, 
    '--psp', make_test_src_path('common/GCN4_YPD.psp'), 
    '--prior-dist', make_test_src_path('common/prior.dist.txt'), 
    make_test_src_path('common/GCN4.meme.txt'), 
    make_test_src_path('common/GCN4_YPD.fasta')
  ],
  [
    {
      output => $out_file, 
      reference => make_test_src_path('fimo/fimo-priors.tsv'), 
      type => 'text', 
      ignore => ['^#']
    }
  ],
  $out_dir
);

# Test fimo with --psp and --prior-dist options
# with genomic coordinates provied in PSP and fasta files.
$out_dir = 'results/fimo4';
$out_file = catfile($out_dir, 'fimo.tsv');
&test('fimo4', '',
  'fimo', '',
  [
    '--oc', $out_dir, 
    '--psp', make_test_src_path('common/GCN4_YPD-genomic.psp'), 
    '--prior-dist', make_test_src_path('common/prior.dist.txt'), 
    make_test_src_path('common/GCN4.meme.txt'), 
    make_test_src_path('common/GCN4_YPD-genomic.fasta')
  ],
  [
    {
      output => $out_file, 
      reference => make_test_src_path('fimo/fimo-priors-genomic.tsv'), 
      type => 'text', 
      ignore => ['^#']
    }
  ],
  $out_dir
);

# Test fimo genomic coordinates in UCSC and Galaxy formats
$out_dir = 'results/fimo5';
$out_file = catfile($out_dir, 'fimo.tsv');
&test('fimo5', '',
  'fimo', '',
  [
    '--oc', $out_dir,
    make_test_src_path('streme/streme.Klf1-200-100.de.xml'),
    make_test_src_path('common/Klf1-200-100_ucsc_galaxy.fa')
  ],
  [
    {
      output => $out_file,
      reference => make_test_src_path('fimo/fimo5.tsv'),
      type => 'text',
      ignore => ['^#']
    }
  ],
  $out_dir
);

# Test fimo genomic coordinates in UCSC and Galaxy formats and --no-pgc.
$out_dir = 'results/fimo6';
$out_file = catfile($out_dir, 'fimo.tsv');
&test('fimo6', '',
  'fimo', '',
  [
    '--oc', $out_dir,
    '--no-pgc',
    make_test_src_path('streme/streme.Klf1-200-100.de.xml'),
    make_test_src_path('common/Klf1-200-100_ucsc_galaxy.fa')
  ],
  [
    {
      output => $out_file,
      reference => make_test_src_path('fimo/fimo6.tsv'),
      type => 'text',
      ignore => ['^#']
    }
  ],
  $out_dir
);
